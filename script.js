let idDivKey=document.getElementById("id-div-key"),idDivChange=document.getElementById("id-div-change"),typeChange=document.getElementById("typeChange"),btnUpdate=document.getElementById("update"),btnCancel=document.getElementById("cancel"),sesionTerminada={terminada:!1},apiKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkc3VsZnd3amxlbmhxYnh3bXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjg3ODQzMjcsImV4cCI6MjA0NDM2MDMyN30.gzUiqwnfWMxwKB8s2VH13gE8NKgu92D0ZatnmsPZ-58",referencia={opcion:0},link=(document.getElementById("changeExamen").addEventListener("click",()=>{idDivKey.style.display="none",idDivChange.style.display="block",document.getElementById("div-new-key").style.display="block";var e=document.getElementById("examKey").innerText;typeChange.innerHTML="Clave actual del cliente: "+` <b id="actualKey">${e}</b>`,referencia.opcion=1}),document.getElementById("changeAdmin").addEventListener("click",()=>{idDivKey.style.display="none",idDivChange.style.display="block",document.getElementById("div-new-key").style.display="none",document.getElementById("etiqueta1").innerHTML="Ingresa la nueva clave";var e=document.getElementById("adminKey").innerText;typeChange.innerHTML="Clave actual del administrador: "+` <b id="actualKey">${e}</b>`,referencia.opcion=2}),btnUpdate.addEventListener("click",()=>{var e,n=document.getElementById("id-new-key").value,t=document.getElementById("id-actual-key").value;1===referencia.opcion?(e=["e","s","c","u","s","u","a","r","i","o","4","5","6","@","y","a","h","o","o",".","c","o","m"],changePassword(e.join(""),t,n,"cliente")):changePassword("",t,t,"administrador")}),btnCancel.addEventListener("click",()=>{idDivChange.style.display="none",idDivKey.style.display="block"}),["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","t","o","k","e","n","?","g","r","a","n","t","_","t","y","p","e","=","p","a","s","s","w","o","r","d"]),API_URL=link.join(""),link2=["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","u","s","e","r"],API_URL2=link2.join("");async function accessUser(e,n){try{var t,a=await fetch(API_URL,{method:["POST"],headers:{"Content-Type":"application/json",apikey:apiKey},body:JSON.stringify({email:e,password:n})});if(!a.ok)throw t=await a.json(),new Error(t.message||"Actualización fallida");var i=(await a.json()).access_token;localStorage.setItem("accessToken",i)}catch(e){console.error("Error durante el cambio:",e),alert("Error en la contraseña actual")}}let changePassword=async(e,n,t,a)=>{let i=null;var o;if("cliente"===a?(o=localStorage.getItem("accessToken"))?i=o:await accessUser(e,n):i=localStorage.getItem("AdminAccessToken"),!i)return[];try{var c,d=await fetch(API_URL2,{method:["PUT"],headers:{"Content-Type":"application/json",apikey:apiKey,Authorization:["Bearer"]+(" "+i)},body:JSON.stringify({password:t})});if(!d.ok)throw c=await d.json(),new Error(c.message);await d.json();alert("Clave cambiada con éxito"),typeChange.innerHTML=`Clave actual del ${a}:`+` <b id="actualKey">${t}</b>`,1===referencia.opcion?document.getElementById("examKey").innerHTML=t:document.getElementById("adminKey").innerHTML=t}catch(e){alert("Error al cambiar la clave"),console.log(e.message)}};function isTokenExpired(){var e=localStorage.getItem("AdminAccessToken");if(!e)return!0;try{var n=jwt_decode(e),t=Date.now()/1e3;return n.exp<t}catch(e){return console.error("Error al decodificar el token:",e),!0}}function handleLogout(){localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href="C:/Users/50683/Desktop/api/admin/login.html"}function checkToken(){isTokenExpired()&&(localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href="C:/Users/50683/Desktop/api/admin/login.html")}document.addEventListener("DOMContentLoaded",checkToken),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&checkToken()}),document.getElementById("logoutButton")?.addEventListener("click",()=>{handleLogout()}),document.getElementById("cerrar")?.addEventListener("click",()=>{handleLogout()});
