let t=document.getElementById("id-div-key"),n=document.getElementById("id-div-change"),l=document.getElementById("typeChange"),e=document.getElementById("update"),a=document.getElementById("cancel"),o="C:/Users/50683/Desktop/api/admin/login.html",c={terminada:!1},d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkc3VsZnd3amxlbmhxYnh3bXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjg3ODQzMjcsImV4cCI6MjA0NDM2MDMyN30.gzUiqwnfWMxwKB8s2VH13gE8NKgu92D0ZatnmsPZ-58",r={opcion:0},i=(document.getElementById("changeExamen").addEventListener("click",()=>{t.style.display="none",n.style.display="block",document.getElementById("div-new-key").style.display="block",document.getElementById("etiqueta1").innerHTML="Ingresa la clave actual",document.getElementById("id-actual-key").value="";var e=document.getElementById("examKey").innerText;l.innerHTML="Clave actual del cliente: "+` <b id="actualKey">${e}</b>`,r.opcion=1}),document.getElementById("changeAdmin").addEventListener("click",()=>{t.style.display="none",n.style.display="block",document.getElementById("div-new-key").style.display="none";document.getElementById("etiqueta1").innerHTML="Ingresa la nueva clave";var e=document.getElementById("adminKey").innerText;l.innerHTML="Clave actual del administrador: "+` <b id="actualKey">${e}</b>`,r.opcion=2}),e.addEventListener("click",()=>{var e,t=document.getElementById("id-new-key").value,n=document.getElementById("id-actual-key").value;1===r.opcion?(e=["e","s","c","u","s","u","a","r","i","o","4","5","6","@","y","a","h","o","o",".","c","o","m"],g(e.join(""),n,t,"cliente")):g("",n,n,"administrador")}),a.addEventListener("click",()=>{n.style.display="none",t.style.display="block"}),["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","t","o","k","e","n","?","g","r","a","n","t","_","t","y","p","e","=","p","a","s","s","w","o","r","d"]),s=i.join(""),m=["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","u","s","e","r"],y=m.join("");async function u(e,t){try{var n,a=await fetch(s,{method:["POST"],headers:{"Content-Type":"application/json",apikey:d},body:JSON.stringify({email:e,password:t})});if(!a.ok)throw n=await a.json(),new Error(n.message||"Actualización fallida");var o=(await a.json()).access_token;localStorage.setItem("accessToken",o)}catch(e){console.error("Error durante el cambio:",e),alert("Error en la contraseña actual")}}let g=async(e,t,n,a)=>{let o=null;try{if("cliente"===a?(o=localStorage.getItem("accessToken"))||(await u(e,t),o=localStorage.getItem("accessToken")):o=localStorage.getItem("AdminAccessToken"),!o)throw new Error("No se ha encontrado un token de autenticación.");var c,i=await fetch(y,{method:"PUT",headers:{"Content-Type":"application/json",apikey:d,Authorization:"Bearer "+o},body:JSON.stringify({password:n})});if(!i.ok)throw c=await i.json(),new Error(c.message||"Error en la solicitud.");await i.json();alert("Clave cambiada con éxito"),l.innerHTML=`Clave actual del ${a}: <b id="actualKey">${n}</b>`,1===r.opcion?document.getElementById("examKey").innerHTML=n:document.getElementById("adminKey").innerHTML=n}catch(e){alert("Error al cambiar la clave"),console.error("Error:",e.message)}};function I(){var t=localStorage.getItem("AdminAccessToken");if(!t)return!0;let e=jwt_decode(t);if("adminapp"!==e.role)return!0;try{let e=jwt_decode(t);var n=Date.now()/1e3;return e.exp<n}catch(e){return console.error("Error al decodificar el token:",e),!0}}function v(){localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href=o}function E(){I()&&(localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href=o)}document.addEventListener("DOMContentLoaded",E),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&E()}),document.getElementById("logoutButton")?.addEventListener("click",()=>{v()}),document.getElementById("cerrar")?.addEventListener("click",()=>{v()});
