let e="https://escuelamanjosanchezlimon.github.io/logineduadmin/",r=["e","y","J","h","b","G","c","i","O","i","J","I","U","z","I","1","N","i","I","s","I","n","R","5","c","C","I","6","I","k","p","X","V","C","J","9",".","e","y","J","p","c","3","M","i","O","i","J","z","d","X","B","h","Y","m","F","z","Z","S","I","s","I","n","J","l","Z","i","I","6","I","m","F","k","c","3","V","s","Z","n","d","3","a","m","x","l","b","m","h","x","Y","n","h","3","b","X","l","v","I","i","w","i","c","m","9","s","Z","S","I","6","I","m","F","u","b","2","4","i","L","C","J","p","Y","X","Q","i","O","j","E","3","M","j","g","3","O","D","Q","z","M","j","c","s","I","m","V","4","c","C","I","6","M","j","A","0","N","D","M","2","M","D","M","y","N","3","0",".","g","z","U","i","q","w","n","f","W","M","x","w","K","B","8","s","2","V","H","1","3","g","E","8","N","K","g","u","9","2","D","0","Z","a","t","n","m","s","P","Z","-","5","8"],t=["e","s","c","u","s","u","a","r","i","o","4","5","6","@","y","a","h","o","o",".","c","o","m"],n=["a","u","t","h","e","n","t","i","c","a","t","e","d"],i=["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","t","o","k","e","n","?","g","r","a","n","t","_","t","y","p","e","=","p","a","s","s","w","o","r","d"],d=["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","a","u","t","h","/","v","1","/","u","s","e","r","?"],s=["h","t","t","p","s",":","/","/","a","d","s","u","l","f","w","w","j","l","e","n","h","q","b","x","w","m","y","o",".","s","u","p","a","b","a","s","e",".","c","o","/","r","e","s","t","/","v","1","/","r","p","c","/","a","c","t","u","a","l","i","z","a","r","_","c","l","a","v","e"],a=document.getElementById("id-div-key"),o=document.getElementById("id-div-change"),m=document.getElementById("typeChange"),c=document.getElementById("update"),l=document.getElementById("cancel"),u={terminada:!1},y={opcion:0};async function g(e,t){try{var a,n=await fetch(i.join(""),{method:"POST",headers:{"Content-Type":"application/json",apikey:r.join("")},body:JSON.stringify({email:e,password:t})});if(!n.ok)throw a=await n.json(),new Error(a.message||"Actualización fallida");var o=(await n.json()).access_token;localStorage.setItem("accessToken",o)}catch(e){alert("Error en la contraseña actual")}}document.getElementById("changeExamen").addEventListener("click",()=>{a.style.display="none",o.style.display="block",document.getElementById("etiqueta1").innerHTML="Ingresa la clave actual",document.getElementById("id-actual-key").value="";var e=document.getElementById("examKey").innerText;m.innerHTML="Clave actual del cliente: "+` <b id="actualKey">${e}</b>`,y.opcion=1}),document.getElementById("changeAdmin").addEventListener("click",()=>{a.style.display="none",o.style.display="block";document.getElementById("etiqueta1").innerHTML="Ingresa la nueva clave";var e=document.getElementById("adminKey").innerText;m.innerHTML="Clave actual del administrador: "+` <b id="actualKey">${e}</b>`,y.opcion=2}),c.addEventListener("click",()=>{var e=document.getElementById("id-actual-key").value;1===y.opcion?v(t.join(""),e,"cliente"):v("",e,"administrador")}),l.addEventListener("click",()=>{o.style.display="none",a.style.display="block"});let v=async(e,t,a)=>{let n=null;if(t.length<6)alert("La clave debe más de 6 carácteres");else try{if("cliente"===a){n=localStorage.getItem("AdminAccessToken");var o,i=await fetch(s.join(""),{method:"POST",headers:{"Content-Type":"application/json",apikey:r.join(""),Authorization:"Bearer "+n},body:JSON.stringify({p_clave:t})});if(!i.ok)throw o=await i.json(),new Error(o.message||"Error en la solicitud.");alert("Clave de usuario cambiada con éxito")}else{if(!(n=localStorage.getItem("AdminAccessToken")))throw new Error("No se ha encontrado un token de autenticación.");var c,l=await fetch(d.join(""),{method:"PUT",headers:{"Content-Type":"application/json",apikey:r.join(""),Authorization:"Bearer "+n},body:JSON.stringify({password:t})});if(!l.ok)throw c=await l.json(),new Error(c.message||"Error en la solicitud.");await l.json();alert("Clave cambiada con éxito")}m.innerHTML=`Clave actual del ${a}: <b id="actualKey">${t}</b>`,1===y.opcion?document.getElementById("examKey").innerHTML=t:document.getElementById("adminKey").innerHTML=t}catch(e){alert("Error al cambiar la clave")}};function p(){var t=localStorage.getItem("AdminAccessToken");if(!t)return!0;let e=jwt_decode(t);if(e.role!==n.join(""))return!0;try{let e=jwt_decode(t);var a=Date.now()/1e3;return e.exp<a}catch(e){return!0}}function h(){localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href=e}function I(){p()&&(localStorage.removeItem("AdminAccessToken"),localStorage.removeItem("accessToken"),window.location.href=e)}document.addEventListener("DOMContentLoaded",I),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&I()}),document.getElementById("logoutButton")?.addEventListener("click",()=>{h()}),document.getElementById("cerrar")?.addEventListener("click",()=>{h()});
